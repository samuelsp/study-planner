services:
  backend:
    build:
      context: ./server
      dockerfile: Dockerfile
      target: builder
    container_name: study-planner-backend-dev
    command: npm run dev
    ports:
      - "4000:4000"
    environment:
      - PORT=4000
      - DATABASE_URL=file:/data/dev.db
      - NODE_ENV=development
    volumes:
      - ./server/src:/app/src
      - ./server/prisma:/app/prisma
      - db-data-dev:/data
    networks:
      - study-planner-network

  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile
      target: builder
    container_name: study-planner-frontend-dev
    command: npm run dev
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=http://localhost:4000
    volumes:
      - ./client/src:/app/src
      - ./client/public:/app/public
      - ./client/index.html:/app/index.html
    networks:
      - study-planner-network
    depends_on:
      - backend

networks:
  study-planner-network:
    driver: bridge

volumes:
  db-data-dev:
    driver: local
